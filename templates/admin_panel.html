
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZSells Admin Panel</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f6fa;
            color: #333;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 5px;
        }
        
        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .nav {
            background: white;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .nav-buttons {
            display: flex;
            gap: 10px;
        }
        
        .nav-btn {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .nav-btn:hover {
            background: #5a67d8;
        }
        
        .logout-btn {
            background: #e53e3e;
        }
        
        .logout-btn:hover {
            background: #c53030;
        }
        
        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
        }
        
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .card h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        
        .embed-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        
        .embed-btn {
            padding: 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: transform 0.2s;
            text-align: center;
        }
        
        .embed-btn:hover {
            transform: translateY(-2px);
        }
        
        .support-btn { background: #48bb78; color: white; }
        .gang-btn { background: #ed8936; color: white; }
        .shop-btn { background: #38b2ac; color: white; }
        .tos-btn { background: #4299e1; color: white; }
        .rules-btn { background: #9f7aea; color: white; }
        .news-btn { background: #f56565; color: white; }
        .welcome-btn { background: #68d391; color: white; }
        .reminder-btn { background: #fbb6ce; color: black; }
        .verification-btn { background: #4fd1c7; color: white; }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #4a5568;
        }
        
        select, textarea, input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 5px;
            font-size: 14px;
        }
        
        select:focus, textarea:focus, input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .send-btn {
            background: #48bb78;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .send-btn:hover {
            background: #38a169;
        }
        
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            text-align: center;
            font-weight: 600;
        }
        
        .status.success {
            background: #c6f6d5;
            color: #22543d;
        }
        
        .status.error {
            background: #fed7d7;
            color: #742a2a;
        }
        
        .detected-channels {
            margin-top: 15px;
        }
        
        .channel-item {
            background: #f7fafc;
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            border-left: 4px solid #667eea;
        }
        
        .channel-item.no-perms {
            border-left-color: #e53e3e;
            background: #fed7d7;
        }
        
        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
            
            .embed-grid {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üéØ ZSells Admin Panel</h1>
        <p>Discord Bot Management Console</p>
    </div>
    
    <div class="nav">
        <div class="nav-buttons">
            <button class="nav-btn" onclick="refreshData()">üîÑ Refresh Data</button>
            <button class="nav-btn" onclick="showDetectedChannels()">üì° Show Detected</button>
        </div>
        <a href="/logout" class="nav-btn logout-btn">üö™ Logout</a>
    </div>
    
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="status {{ category }}">{{ message }}</div>
            {% endfor %}
        {% endif %}
    {% endwith %}
    
    <div class="container">
        <div class="grid">
            <div class="card">
                <h3>üöÄ Embed Spawner</h3>
                <div class="form-group">
                    <label for="guild-select">Select Server:</label>
                    <select id="guild-select" onchange="loadChannels()">
                        <option value="">Loading servers...</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="channel-select">Select Channel:</label>
                    <select id="channel-select">
                        <option value="">Select a server first</option>
                    </select>
                </div>
                
                <div class="embed-grid">
                    <button class="embed-btn support-btn" onclick="spawnEmbed('support')">üé´ Support</button>
                    <button class="embed-btn gang-btn" onclick="spawnEmbed('gang')">‚öîÔ∏è Gang</button>
                    <button class="embed-btn shop-btn" onclick="spawnEmbed('shop')">üõí Shop</button>
                    <button class="embed-btn tos-btn" onclick="spawnEmbed('tos')">üìã ToS</button>
                    <button class="embed-btn rules-btn" onclick="spawnEmbed('rules')">üìú Rules</button>
                    <button class="embed-btn news-btn" onclick="spawnEmbed('news')">üì∞ News</button>
                    <button class="embed-btn welcome-btn" onclick="spawnEmbed('welcome')">üëã Welcome</button>
                    <button class="embed-btn reminder-btn" onclick="spawnEmbed('reminder')">üíé Reminder</button>
                    <button class="embed-btn verification-btn" onclick="spawnEmbed('verification')">‚úÖ Verify</button>
                </div>
                
                <div id="spawn-status"></div>
            </div>
            
            <div class="card">
                <h3>üí¨ Custom Message Sender</h3>
                <div class="form-group">
                    <label for="msg-channel-select">Target Channel:</label>
                    <select id="msg-channel-select">
                        <option value="">Select channel...</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="custom-message">Message Content:</label>
                    <textarea id="custom-message" rows="4" placeholder="Enter your custom message here..."></textarea>
                </div>
                
                <button class="send-btn" onclick="sendCustomMessage()">üì§ Send Message</button>
                <div id="message-status"></div>
            </div>
        </div>
        
        <div class="card" style="margin-top: 20px;">
            <h3>üìä Server Information</h3>
            <div id="server-info">Loading server information...</div>
        </div>
        
        <div class="card" style="margin-top: 20px;">
            <h3>üì° Auto-Detected Channels</h3>
            <div id="detected-channels">Loading detected channels...</div>
        </div>
    </div>
    
    <script>
        let guildsData = [];
        
        async function loadGuilds() {
            try {
                const response = await fetch('/get_guilds');
                const data = await response.json();
                guildsData = data.guilds;
                
                const guildSelect = document.getElementById('guild-select');
                guildSelect.innerHTML = '<option value="">Select a server...</option>';
                
                guildsData.forEach(guild => {
                    const option = document.createElement('option');
                    option.value = guild.id;
                    option.textContent = `${guild.name} (${guild.member_count} members)`;
                    guildSelect.appendChild(option);
                });
                
                updateServerInfo();
            } catch (error) {
                console.error('Error loading guilds:', error);
            }
        }
        
        function loadChannels() {
            const guildId = document.getElementById('guild-select').value;
            const channelSelect = document.getElementById('channel-select');
            const msgChannelSelect = document.getElementById('msg-channel-select');
            
            channelSelect.innerHTML = '<option value="">Select a channel...</option>';
            msgChannelSelect.innerHTML = '<option value="">Select a channel...</option>';
            
            if (!guildId) return;
            
            const guild = guildsData.find(g => g.id == guildId);
            if (!guild) return;
            
            guild.channels.forEach(channel => {
                const option1 = document.createElement('option');
                option1.value = channel.id;
                option1.textContent = `#${channel.name}${channel.permissions ? ' ‚úÖ' : ' ‚ùå'}`;
                channelSelect.appendChild(option1);
                
                const option2 = document.createElement('option');
                option2.value = channel.id;
                option2.textContent = `#${channel.name}${channel.permissions ? ' ‚úÖ' : ' ‚ùå'}`;
                msgChannelSelect.appendChild(option2);
            });
        }
        
        async function spawnEmbed(embedType) {
            const channelId = document.getElementById('channel-select').value;
            if (!channelId) {
                showStatus('spawn-status', 'Please select a channel first!', 'error');
                return;
            }
            
            try {
                const response = await fetch('/spawn_embed', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        embed_type: embedType,
                        channel_id: channelId
                    })
                });
                
                const data = await response.json();
                if (data.success) {
                    showStatus('spawn-status', data.message, 'success');
                } else {
                    showStatus('spawn-status', data.error, 'error');
                }
            } catch (error) {
                showStatus('spawn-status', 'Error spawning embed: ' + error.message, 'error');
            }
        }
        
        async function sendCustomMessage() {
            const channelId = document.getElementById('msg-channel-select').value;
            const message = document.getElementById('custom-message').value;
            
            if (!channelId || !message) {
                showStatus('message-status', 'Please select a channel and enter a message!', 'error');
                return;
            }
            
            try {
                const response = await fetch('/send_custom_message', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        channel_id: channelId,
                        message: message
                    })
                });
                
                const data = await response.json();
                if (data.success) {
                    showStatus('message-status', data.message, 'success');
                    document.getElementById('custom-message').value = '';
                } else {
                    showStatus('message-status', data.error, 'error');
                }
            } catch (error) {
                showStatus('message-status', 'Error sending message: ' + error.message, 'error');
            }
        }
        
        async function loadDetectedChannels() {
            try {
                const response = await fetch('/get_detected_channels');
                const data = await response.json();
                
                const container = document.getElementById('detected-channels');
                if (data.channels.length === 0) {
                    container.innerHTML = '<p>No channels auto-detected yet.</p>';
                    return;
                }
                
                container.innerHTML = data.channels.map(channel => `
                    <div class="channel-item ${channel.permissions ? '' : 'no-perms'}">
                        <strong>${channel.type}</strong>: #${channel.name} (${channel.guild})
                        ${channel.permissions ? '‚úÖ Permissions OK' : '‚ùå No Permissions'}
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading detected channels:', error);
            }
        }
        
        function updateServerInfo() {
            const serverInfo = document.getElementById('server-info');
            if (guildsData.length === 0) {
                serverInfo.innerHTML = '<p>No servers found. Make sure the bot is running and has joined servers.</p>';
                return;
            }
            
            const totalMembers = guildsData.reduce((sum, guild) => sum + guild.member_count, 0);
            const totalChannels = guildsData.reduce((sum, guild) => sum + guild.channels.length, 0);
            
            serverInfo.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div><strong>Total Servers:</strong> ${guildsData.length}</div>
                    <div><strong>Total Members:</strong> ${totalMembers.toLocaleString()}</div>
                    <div><strong>Total Channels:</strong> ${totalChannels}</div>
                    <div><strong>Bot Status:</strong> <span style="color: green;">‚úÖ Online</span></div>
                </div>
            `;
        }
        
        function showStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="status ${type}">${message}</div>`;
            setTimeout(() => {
                element.innerHTML = '';
            }, 5000);
        }
        
        function refreshData() {
            loadGuilds();
            loadDetectedChannels();
        }
        
        function showDetectedChannels() {
            document.getElementById('detected-channels').scrollIntoView({ behavior: 'smooth' });
        }
        
        // Load data on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadGuilds();
            loadDetectedChannels();
        });
    </script>
</body>
</html>
